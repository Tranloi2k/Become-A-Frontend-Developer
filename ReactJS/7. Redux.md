# Redux là gì? Hướng dẫn chi tiết về Redux

---

## 1. Redux là gì?

**Redux** là một thư viện quản lý state (trạng thái) phổ biến cho ứng dụng JavaScript, đặc biệt là với React. Redux giúp bạn lưu trữ và quản lý trạng thái toàn cục của ứng dụng một cách nhất quán, dễ kiểm soát và dễ debug.

Redux hoạt động độc lập, không chỉ dành cho React, mà còn có thể dùng với các framework khác như Angular, Vue, hoặc thậm chí Vanilla JS.

---

## 2. Vấn đề Redux giải quyết

- **Quản lý state phức tạp:** Khi ứng dụng lớn, có nhiều component cần chia sẻ dữ liệu với nhau, việc truyền props hoặc dùng context API sẽ trở nên khó kiểm soát và dễ lỗi.
- **Prop drilling:** Tránh phải truyền props qua nhiều cấp component.
- **State đồng bộ:** Đảm bảo mọi phần của ứng dụng luôn cập nhật đúng khi state thay đổi.
- **Debug và kiểm soát tốt hơn:** Redux DevTools giúp theo dõi lịch sử state, undo/redo, và dễ dàng debug.

---

## 3. Nguyên lý hoạt động của Redux

Redux dựa trên 3 nguyên tắc chính:

1. **Single Source of Truth:**  
   Toàn bộ state của ứng dụng được lưu trong một object duy nhất gọi là **store**.

2. **State chỉ được đọc, không được sửa trực tiếp:**  
   State chỉ được thay đổi thông qua **action** và **reducer**. Bạn không bao giờ thay đổi state trực tiếp.

3. **Thay đổi state thông qua pure function (reducer):**  
   Reducer là hàm thuần (pure function) nhận vào state hiện tại và action, trả về state mới.

---

## 4. Các khái niệm chính trong Redux

- **Store:** Nơi lưu trữ toàn bộ state của ứng dụng.
- **Action:** Là một object mô tả hành động muốn thực hiện (phải có thuộc tính `type`).
- **Reducer:** Hàm pure function nhận vào state hiện tại và action, trả về state mới.
- **Dispatch:** Hàm dùng để gửi (dispatch) action tới store.
- **Selector:** Hàm lấy dữ liệu từ state (thường dùng với `useSelector` trong React-Redux).
- **Middleware:** Hỗ trợ xử lý các logic side effect (async, logging, v.v.) như redux-thunk, redux-saga.

---

## 5. Quy trình hoạt động của Redux (Data Flow)

1. Người dùng thao tác UI (bấm nút, nhập form, ...)
2. Component gọi `dispatch(action)`
3. Store nhận action, chuyển cho reducer
4. Reducer xử lý, trả về state mới
5. Store cập nhật state, các component liên quan được re-render

---

## 6. Ví dụ cơ bản về Redux với React

**1. Cài đặt**
```bash
npm install redux react-redux
```

**2. Tạo action**
```js
// actions/counterActions.js
export const increment = () => ({ type: 'INCREMENT' });
export const decrement = () => ({ type: 'DECREMENT' });
```

**3. Tạo reducer**
```js
// reducers/counterReducer.js
const initialState = { count: 0 };

function counterReducer(state = initialState, action) {
  switch (action.type) {
    case 'INCREMENT':
      return { count: state.count + 1 };
    case 'DECREMENT':
      return { count: state.count - 1 };
    default:
      return state;
  }
}
export default counterReducer;
```

**4. Tạo store**
```js
// store.js
import { createStore } from 'redux';
import counterReducer from './reducers/counterReducer';

const store = createStore(counterReducer);
export default store;
```

**5. Kết nối Redux với React**
```jsx
// index.js
import React from 'react';
import ReactDOM from 'react-dom/client';
import { Provider } from 'react-redux';
import store from './store';
import App from './App';

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(
  <Provider store={store}>
    <App />
  </Provider>
);
```

**6. Sử dụng Redux trong component**
```jsx
// Counter.js
import React from 'react';
import { useSelector, useDispatch } from 'react-redux';
import { increment, decrement } from './actions/counterActions';

function Counter() {
  const count = useSelector(state => state.count);
  const dispatch = useDispatch();

  return (
    <div>
      <h2>Giá trị: {count}</h2>
      <button onClick={() => dispatch(increment())}>Tăng</button>
      <button onClick={() => dispatch(decrement())}>Giảm</button>
    </div>
  );
}
export default Counter;
```

---

## 7. Ưu điểm của Redux

- Quản lý state toàn cục một cách rõ ràng, dễ kiểm soát
- Debug dễ dàng với Redux DevTools
- Dễ mở rộng, dễ test
- Tối ưu performance khi dùng selector hợp lý

---

## 8. Nhược điểm của Redux

- Cấu hình ban đầu phức tạp cho ứng dụng nhỏ
- Viết code dài dòng (boilerplate)
- Dễ lạm dụng cho các state không cần thiết (state local của component)
- Cần hiểu kỹ về immutable state để tránh bug

---

## 9. Khi nào nên dùng Redux?

**Nên dùng:**
- Ứng dụng lớn, nhiều component cần chia sẻ state
- Cần debug, kiểm soát lịch sử state, undo/redo
- Ứng dụng có nhiều logic xử lý bất đồng bộ, side effect

**Không nên dùng:**
- Ứng dụng nhỏ, ít component, state đơn giản
- Chủ yếu là UI state cục bộ, không có logic phức tạp

---

## 10. Các lưu ý khi dùng Redux trong thực tế

- Chỉ lưu state "toàn cục" vào Redux, state "cục bộ" nên dùng useState/useReducer trong component
- Sử dụng các thư viện như `redux-toolkit` để giảm bớt boilerplate
- Sử dụng selector hợp lý để tối ưu performance
- Tránh lưu dữ liệu lớn/không cần thiết vào Redux (ví dụ: dữ liệu tạm thời, state input từng field nhỏ)
- Kết hợp middleware (redux-thunk, redux-saga) khi xử lý async

---

## 11. Các thư viện liên quan hữu ích

- **redux-toolkit:** Bộ công cụ chuẩn hóa, đơn giản hóa code Redux
- **react-redux:** Thư viện kết nối Redux với React (Provider, useSelector, useDispatch)
- **redux-thunk, redux-saga:** Middleware hỗ trợ xử lý side effect, bất đồng bộ
- **reselect:** Tạo selector có memoization tối ưu re-render

---

## 12. Tóm tắt

| Đặc điểm     | Redux                                                        |
|--------------|-------------------------------------------------------------|
| Kiểu state   | Toàn cục (global)                                           |
| Nguyên lý    | Store, Action, Reducer, Dispatch                            |
| Ưu điểm      | Quản lý state rõ ràng, debug tốt, dễ mở rộng                |
| Nhược điểm   | Boilerplate nhiều, khó cho app nhỏ, dễ lạm dụng              |
| Khi nên dùng | Ứng dụng lớn, nhiều logic, cần kiểm soát state phức tạp     |
| Lưu ý        | Chỉ lưu state cần thiết, ưu tiên redux-toolkit, tối ưu selector |

---

**Kết luận**: Redux là công cụ mạnh mẽ cho quản lý state toàn cục của ứng dụng React. Tuy nhiên, chỉ nên dùng khi thực sự cần thiết, tránh lạm dụng cho các ứng dụng nhỏ hoặc state cục bộ đơn giản.
